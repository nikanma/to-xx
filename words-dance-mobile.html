<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="format-detection" content="telephone=no">
    <meta name="theme-color" content="#26c6da">
    <title>ÁâπÂà´ÁöÑËØùËØ≠</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=ZCOOL+KuaiLe&family=Ma+Shan+Zheng&display=swap" rel="stylesheet">
    <style>
* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
}

html, body {
    width: 100%;
    height: 100%;
    overflow: hidden;
    -webkit-tap-highlight-color: transparent;
    -webkit-touch-callout: none;
    -webkit-user-select: none;
    user-select: none;
}

body {
    font-family: 'ZCOOL KuaiLe', 'Ma Shan Zheng', cursive;
    background: linear-gradient(135deg, #e0f7fa 0%, #b2ebf2 25%, #80deea 50%, #4dd0e1 75%, #26c6da 100%);
    background-size: 400% 400%;
    animation: gradientShift 15s ease infinite;
    display: flex;
    justify-content: center;
    align-items: center;
    min-height: 100vh;
    position: relative;
}

.container {
    display: flex;
    justify-content: center;
    align-items: center;
    width: 100%;
    height: 100%;
    padding: 20px;
    position: relative;
    z-index: 1;
    touch-action: none;
    overflow: hidden;
}

.text-container {
    display: flex;
    justify-content: center;
    align-items: center;
    text-align: center;
    max-width: 90%;
    min-height: 200px;
}

#text-display {
    display: inline-block;
    color: #1a1a1a;
    text-shadow: 
        0 0 15px rgba(0, 150, 136, 0.15),
        0 2px 4px rgba(0, 0, 0, 0.12);
    letter-spacing: 0.15em;
    line-height: 1.6;
    padding: 10px 20px;
    font-size: clamp(1.5rem, 5vw, 3rem);
}

.text-wrapper {
    display: inline-block;
    opacity: 0;
    transform: translateY(50px) scale(0.8);
    animation-duration: 800ms;
    animation-timing-function: cubic-bezier(0.4, 0, 0.2, 1);
    animation-fill-mode: forwards;
}

.text-wrapper.enter {
    animation-name: fadeInUp;
}

.text-wrapper.exit {
    animation-name: fadeOutUp;
}

@keyframes fadeInUp {
    from {
        opacity: 0;
        transform: translateY(50px) scale(0.8);
    }
    to {
        opacity: 1;
        transform: translateY(0) scale(1);
    }
}

@keyframes fadeOutUp {
    from {
        opacity: 1;
        transform: translateY(0) scale(1);
    }
    to {
        opacity: 0;
        transform: translateY(-30px) scale(0.9);
    }
}

.heart {
    color: #FF7F50;
    display: inline-block;
    animation: heartbeat 1s ease-in-out infinite;
}

.kiss-emoji {
    display: inline-block;
    animation: heartbeat 1s ease-in-out infinite;
}

@keyframes heartbeat {
    0%, 100% { transform: scale(1); }
    50% { transform: scale(1.2); }
}

@keyframes gradientShift {
    0%, 100% { background-position: 0% 50%; }
    50% { background-position: 100% 50%; }
}

.tap-hint {
    position: fixed;
    bottom: 30px;
    left: 50%;
    transform: translateX(-50%);
    color: rgba(0, 0, 0, 0.4);
    font-size: 1rem;
    opacity: 0;
    transition: opacity 0.3s ease;
    pointer-events: none;
    z-index: 100;
}

.music-toggle {
    position: fixed;
    width: 50px;
    height: 50px;
    background: #ffffff;
    border-radius: 50%;
    display: flex;
    justify-content: center;
    align-items: center;
    cursor: grab;
    box-shadow: 0 4px 15px rgba(0, 0, 0, 0.15);
    z-index: 1002;
    transition: transform 0.2s ease, box-shadow 0.2s ease;
    left: 20px;
    bottom: 100px;
    user-select: none;
    touch-action: none;
}

.music-toggle:hover {
    transform: scale(1.1);
}

.music-toggle.dragging {
    cursor: grabbing;
    transform: scale(1.05);
    box-shadow: 0 8px 25px rgba(0, 0, 0, 0.25);
}

.music-toggle.playing {
    animation: pulse 2s infinite;
}

@keyframes pulse {
    0%, 100% { box-shadow: 0 4px 15px rgba(0, 0, 0, 0.15); }
    50% { box-shadow: 0 4px 25px rgba(38, 198, 218, 0.5); }
}

.music-icon {
    font-size: 24px;
    color: #333;
    pointer-events: none;
}

.music-panel {
    position: fixed;
    background: rgba(255, 255, 255, 0.95);
    backdrop-filter: blur(10px);
    border-radius: 20px;
    padding: 0 20px 20px 20px;
    box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2);
    z-index: 1001;
    display: none;
    min-width: 280px;
    max-width: 90vw;
    opacity: 0;
    transform: scale(0.9);
    transition: opacity 0.3s ease, transform 0.3s ease;
    cursor: grab;
}

.music-panel.dragging {
    cursor: grabbing;
}

.panel-drag-handle {
    padding: 15px 0 10px 0;
    text-align: center;
    cursor: grab;
    user-select: none;
    touch-action: none;
}

.panel-drag-handle:active {
    cursor: grabbing;
}

.drag-line {
    width: 40px;
    height: 4px;
    background: #ddd;
    border-radius: 2px;
    margin: 0 auto 5px;
}

.drag-icon {
    font-size: 12px;
    color: #999;
    letter-spacing: 2px;
    display: block;
}

.music-panel.show {
    display: block;
    opacity: 1;
    transform: scale(1);
}

.music-list {
    margin-bottom: 15px;
}

.music-item {
    display: flex;
    align-items: center;
    padding: 12px 16px;
    cursor: pointer;
    border-radius: 12px;
    transition: background 0.2s ease;
    margin-bottom: 8px;
}

.music-item:last-child {
    margin-bottom: 0;
}

.music-item:hover {
    background: rgba(38, 198, 218, 0.1);
}

.music-item.selected {
    color: #26c6da;
    font-weight: bold;
}

.radio-circle {
    width: 18px;
    height: 18px;
    border: 2px solid #999;
    border-radius: 50%;
    margin-right: 12px;
    transition: all 0.2s ease;
    flex-shrink: 0;
}

.music-item.selected .radio-circle {
    background: #26c6da;
    border-color: #26c6da;
}

.music-name {
    font-size: 15px;
}

.music-controls {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding-top: 15px;
    border-top: 1px solid rgba(0, 0, 0, 0.1);
}

.btn-play {
    background: #26c6da;
    color: white;
    border: none;
    padding: 10px 24px;
    border-radius: 25px;
    font-size: 14px;
    cursor: pointer;
    transition: all 0.2s ease;
    font-family: inherit;
}

.btn-play:hover {
    background: #00bcd4;
    transform: scale(1.05);
}

.volume-control {
    display: flex;
    align-items: center;
    gap: 8px;
}

.volume-slider {
    width: 80px;
    height: 4px;
    -webkit-appearance: none;
    appearance: none;
    background: #ddd;
    border-radius: 2px;
    outline: none;
}

.volume-slider::-webkit-slider-thumb {
    -webkit-appearance: none;
    appearance: none;
    width: 14px;
    height: 14px;
    background: #26c6da;
    border-radius: 50%;
    cursor: pointer;
}

.volume-icon {
    font-size: 16px;
}

@media (max-width: 480px) {
    .container {
        padding: 15px;
    }
    
    .text-container {
        min-height: 150px;
    }
    
    #text-display {
        padding: 8px 16px;
    }
    
    .music-panel {
        padding: 15px;
        min-width: 260px;
    }
}
    </style>
</head>
<body>
    <div class="container">
        <div class="text-container">
            <span id="text-display"></span>
        </div>
    </div>
    <div class="tap-hint">ÁÇπÂáªÂèØ‰ª•Á≠â‰∏Ä‰ºöÂñî</div>
    
    <div class="music-toggle" id="musicToggle">
        <span class="music-icon">‚ô™</span>
    </div>
    
    <div class="music-panel" id="musicPanel">
        <div class="panel-drag-handle" id="panelDragHandle">
            <div class="drag-line"></div>
            <span class="drag-icon">‚ãÆ‚ãÆ</span>
        </div>
        <div class="music-list" id="musicList"></div>
        <div class="music-controls">
            <button class="btn-play" id="btnPlay">Êí≠Êîæ</button>
            <div class="volume-control">
                <span class="volume-icon">üîä</span>
                <input type="range" class="volume-slider" id="volumeSlider" min="0" max="100" value="50">
            </div>
        </div>
    </div>

    <script>
const messages = [
    { text: 'ÂÆùË¥ù', time: 3000, size: 5 },
    { text: 'ÂñúÊ¨¢‰Ω†‚ù§', time: 5000, size: 4 },
    { text: 'Âßã‰∫éÂØπËßÜÊó∂ÁöÑÊÄ¶ÁÑ∂ÂøÉÂä®', time: 7000, size: 5 },
    { text: '‰∫≤‰∫≤‰Ω†üòö', time: 2000, size: 4 }
];

const musicList = [
    { name: 'Êúâ‰Ωï‰∏çÂèØ', url: 'https://nikanma.github.io/to-xx/youhebuke.mp3' },
    { name: 'Â±ãÈ°∂', url: 'https://nikanma.github.io/to-xx/wuding.mp3' },
    { name: 'ÁâπÂà´ÁöÑ‰∫∫', url: 'https://nikanma.github.io/to-xx/tebiederen.mp3' }
];

const musicKey = 'musicProgress';
const musicSrcKey = 'musicSrc';

const textDisplay = document.getElementById('text-display');
const tapHint = document.querySelector('.tap-hint');
let currentIndex = 0;
let isPaused = false;
let remainingTime = 0;
let pauseStartTime = 0;
let exitTimer = null;
let enterTimer = null;
let wrapper = null;

let musicState = {
    currentMusicIndex: -1,
    isPlaying: false,
    volume: 0.5,
    audio: null
};

function displayNextMessage() {
    if (isPaused) return;
    
    const message = messages[currentIndex];
    remainingTime = message.time;
    
    let displayText = message.text;
    if (message.text.includes('‚ù§')) {
        displayText = message.text.replace('‚ù§', '<span class="heart">‚ù§</span>');
    }
    if (message.text.includes('üòö')) {
        displayText = displayText.replace('üòö', '<span class="kiss-emoji">üòö</span>');
    }
    
    wrapper = document.createElement('span');
    wrapper.className = 'text-wrapper enter';
    wrapper.innerHTML = displayText;
    wrapper.style.fontSize = message.size + 'rem';
    
    textDisplay.innerHTML = '';
    textDisplay.appendChild(wrapper);
    
    enterTimer = setTimeout(() => {
        wrapper.className = 'text-wrapper';
        wrapper.style.opacity = '1';
        wrapper.style.transform = 'translateY(0) scale(1)';
        tapHint.style.opacity = '1';
    }, 800);
    
    exitTimer = setTimeout(() => {
        wrapper.className = 'text-wrapper exit';
        tapHint.style.opacity = '0';
        
        setTimeout(() => {
            wrapper.style.opacity = '0';
            wrapper.style.transform = 'translateY(-30px) scale(0.9)';
            currentIndex = (currentIndex + 1) % messages.length;
            
            setTimeout(() => {
                if (!isPaused) {
                    displayNextMessage();
                }
            }, 800);
        }, 800);
    }, remainingTime);
}

function togglePause(e) {
    if (e.target.closest('.music-toggle') || e.target.closest('.music-panel')) {
        return;
    }
    
    if (!isPaused) {
        clearTimeout(exitTimer);
        clearTimeout(enterTimer);
        pauseStartTime = Date.now();
        isPaused = true;
        tapHint.style.opacity = '0';
    } else {
        const pausedDuration = Date.now() - pauseStartTime;
        remainingTime = Math.max(0, remainingTime - pausedDuration);
        isPaused = false;
        tapHint.style.opacity = '1';
        
        if (remainingTime <= 0) {
            if (wrapper) {
                wrapper.className = 'text-wrapper exit';
                setTimeout(() => {
                    wrapper.style.opacity = '0';
                    wrapper.style.transform = 'translateY(-30px) scale(0.9)';
                    currentIndex = (currentIndex + 1) % messages.length;
                    setTimeout(() => {
                        displayNextMessage();
                    }, 800);
                }, 800);
            }
        } else {
            exitTimer = setTimeout(() => {
                if (wrapper) {
                    wrapper.className = 'text-wrapper exit';
                    setTimeout(() => {
                        wrapper.style.opacity = '0';
                        wrapper.style.transform = 'translateY(-30px) scale(0.9)';
                        currentIndex = (currentIndex + 1) % messages.length;
                        setTimeout(() => {
                            displayNextMessage();
                        }, 800);
                    }, 800);
                }
            }, remainingTime);
        }
    }
}

function startAnimation() {
    requestAnimationFrame(() => {
        requestAnimationFrame(() => {
            setTimeout(() => {
                displayNextMessage();
            }, 1000);
        });
    });
}

if (document.fonts && document.fonts.ready) {
    document.fonts.ready.then(startAnimation);
} else {
    window.addEventListener('load', () => {
        setTimeout(startAnimation, 1000);
    });
}

document.body.addEventListener('click', (e) => togglePause(e));

const musicToggle = document.getElementById('musicToggle');
const musicPanel = document.getElementById('musicPanel');
const musicListContainer = document.getElementById('musicList');
const btnPlay = document.getElementById('btnPlay');
const volumeSlider = document.getElementById('volumeSlider');

let isDragging = false;
let dragStartX, dragStartY;
let toggleStartX, toggleStartY;

function initMusicList() {
    musicListContainer.innerHTML = '';
    musicList.forEach((music, index) => {
        const item = document.createElement('div');
        item.className = 'music-item';
        item.dataset.index = index;
        item.innerHTML = `
            <div class="radio-circle"></div>
            <span class="music-name">${music.name}</span>
        `;
        item.addEventListener('click', () => selectMusic(index));
        musicListContainer.appendChild(item);
    });
}

function selectMusic(index) {
    musicState.currentMusicIndex = index;
    updateMusicListUI();
    
    if (musicState.audio) {
        musicState.audio.pause();
        musicState.audio = null;
    }
    
    musicState.audio = new Audio(musicList[index].url);
    musicState.audio.volume = musicState.volume;
    musicState.audio.loop = true;
    
    closePanel();
    
    musicState.audio.play().then(() => {
        musicState.isPlaying = true;
        updatePlayButton();
        musicToggle.classList.add('playing');
    }).catch(e => {
        console.log('Êí≠ÊîæÂ§±Ë¥•:', e);
        musicState.isPlaying = false;
        updatePlayButton();
    });
}

function updateMusicListUI() {
    const items = musicListContainer.querySelectorAll('.music-item');
    items.forEach((item, index) => {
        if (index === musicState.currentMusicIndex) {
            item.classList.add('selected');
        } else {
            item.classList.remove('selected');
        }
    });
}

function togglePlay() {
    if (!musicState.audio) {
        if (musicState.currentMusicIndex === -1) {
            selectMusic(0);
        }
        return;
    }
    
    if (musicState.isPlaying) {
        musicState.audio.pause();
        musicState.isPlaying = false;
        musicToggle.classList.remove('playing');
    } else {
        musicState.audio.play();
        musicState.isPlaying = true;
        musicToggle.classList.add('playing');
    }
    updatePlayButton();
    closePanel();
}

function updatePlayButton() {
    btnPlay.textContent = musicState.isPlaying ? 'ÊöÇÂÅú' : 'Êí≠Êîæ';
}

function setVolume(value) {
    musicState.volume = value / 100;
    if (musicState.audio) {
        musicState.audio.volume = musicState.volume;
    }
}

function openPanel() {
    musicPanel.style.left = '50%';
    musicPanel.style.top = '50%';
    musicPanel.style.transform = 'translate(-50%, -50%) scale(1)';
    musicPanel.classList.add('show');
}

function closePanel() {
    musicPanel.style.display = 'none';
    musicPanel.classList.remove('show');
    musicPanel.style.transform = 'translate(-50%, -50%) scale(0.9)';
}

function saveMusicProgress() {
    if (musicState.audio && !musicState.audio.paused) {
        localStorage.setItem(musicKey, musicState.audio.currentTime);
        localStorage.setItem(musicSrcKey, musicState.audio.src);
    }
}

setInterval(saveMusicProgress, 5000);

function restoreMusicProgress() {
    const savedTime = localStorage.getItem(musicKey);
    const savedSrc = localStorage.getItem(musicSrcKey);
    
    if (savedSrc) {
        let matchedIndex = -1;
        for (let i = 0; i < musicList.length; i++) {
            if (savedSrc.includes(musicList[i].url.split('/').pop())) {
                matchedIndex = i;
                break;
            }
        }
        
        if (matchedIndex !== -1) {
            musicState.currentMusicIndex = matchedIndex;
            musicState.audio = new Audio(musicList[matchedIndex].url);
            musicState.audio.volume = musicState.volume;
            musicState.audio.loop = true;
            
            if (savedTime) {
                musicState.audio.currentTime = parseFloat(savedTime);
            }
            
            musicState.audio.play().then(() => {
                musicState.isPlaying = true;
                updatePlayButton();
                musicToggle.classList.add('playing');
                updateMusicListUI();
            }).catch(e => {
                console.log('Ëá™Âä®Êí≠ÊîæË¢´ÈòªÊ≠¢');
            });
        }
    }
}

musicToggle.addEventListener('mousedown', startDrag);
musicToggle.addEventListener('touchstart', startDrag, { passive: false });

function startDrag(e) {
    isDragging = true;
    musicToggle.classList.add('dragging');
    
    const clientX = e.type.includes('touch') ? e.touches[0].clientX : e.clientX;
    const clientY = e.type.includes('touch') ? e.touches[0].clientY : e.clientY;
    
    dragStartX = clientX;
    dragStartY = clientY;
    
    const rect = musicToggle.getBoundingClientRect();
    toggleStartX = rect.left;
    toggleStartY = rect.top;
}

function drag(e) {
    if (!isDragging) return;
    e.preventDefault();
    
    const clientX = e.type.includes('touch') ? e.touches[0].clientX : e.clientX;
    const clientY = e.type.includes('touch') ? e.touches[0].clientY : e.clientY;
    
    const deltaX = clientX - dragStartX;
    const deltaY = clientY - dragStartY;
    
    let newX = toggleStartX + deltaX;
    let newY = toggleStartY + deltaY;
    
    newX = Math.max(10, Math.min(newX, window.innerWidth - 60));
    newY = Math.max(10, Math.min(newY, window.innerHeight - 60));
    
    musicToggle.style.left = newX + 'px';
    musicToggle.style.bottom = 'auto';
    musicToggle.style.top = newY + 'px';
}

function endDrag(e) {
    if (!isDragging) return;
    isDragging = false;
    musicToggle.classList.remove('dragging');
    
    const deltaX = e.type.includes('touch') ? 
        Math.abs(e.changedTouches[0].clientX - dragStartX) : 
        Math.abs(e.clientX - dragStartX);
    const deltaY = e.type.includes('touch') ? 
        Math.abs(e.changedTouches[0].clientY - dragStartY) : 
        Math.abs(e.clientY - dragStartY);
    
    if (deltaX < 5 && deltaY < 5) {
        if (musicPanel.classList.contains('show')) {
            closePanel();
        } else {
            musicPanel.style.display = 'block';
            requestAnimationFrame(() => {
                openPanel();
            });
        }
    }
}

btnPlay.addEventListener('click', togglePlay);
volumeSlider.addEventListener('input', (e) => setVolume(e.target.value));

const panelDragHandle = document.getElementById('panelDragHandle');
let isPanelDragging = false;
let panelDragStartX, panelDragStartY;
let panelStartX, panelStartY;

panelDragHandle.addEventListener('mousedown', startPanelDrag);
panelDragHandle.addEventListener('touchstart', startPanelDrag, { passive: false });

function startPanelDrag(e) {
    isPanelDragging = true;
    musicPanel.classList.add('dragging');
    
    const clientX = e.type.includes('touch') ? e.touches[0].clientX : e.clientX;
    const clientY = e.type.includes('touch') ? e.touches[0].clientY : e.clientY;
    
    panelDragStartX = clientX;
    panelDragStartY = clientY;
    
    const rect = musicPanel.getBoundingClientRect();
    panelStartX = rect.left;
    panelStartY = rect.top;
    
    e.preventDefault();
}

function dragPanel(e) {
    if (!isPanelDragging) return;
    e.preventDefault();
    
    const clientX = e.type.includes('touch') ? e.touches[0].clientX : e.clientX;
    const clientY = e.type.includes('touch') ? e.touches[0].clientY : e.clientY;
    
    const deltaX = clientX - panelDragStartX;
    const deltaY = clientY - panelDragStartY;
    
    let newX = panelStartX + deltaX;
    let newY = panelStartY + deltaY;
    
    const panelRect = musicPanel.getBoundingClientRect();
    newX = Math.max(10, Math.min(newX, window.innerWidth - panelRect.width - 10));
    newY = Math.max(10, Math.min(newY, window.innerHeight - panelRect.height - 10));
    
    musicPanel.style.left = newX + 'px';
    musicPanel.style.top = newY + 'px';
    musicPanel.style.transform = 'scale(1)';
}

function endPanelDrag(e) {
    if (!isPanelDragging) return;
    isPanelDragging = false;
    musicPanel.classList.remove('dragging');
}

document.addEventListener('mousemove', (e) => {
    if (isDragging) drag(e);
    if (isPanelDragging) dragPanel(e);
});

document.addEventListener('touchmove', (e) => {
    if (isDragging) drag(e);
    if (isPanelDragging) dragPanel(e);
}, { passive: false });

document.addEventListener('mouseup', (e) => {
    if (isDragging) endDrag(e);
    if (isPanelDragging) endPanelDrag(e);
});

document.addEventListener('touchend', (e) => {
    if (isDragging) endDrag(e);
    if (isPanelDragging) endPanelDrag(e);
});

initMusicList();

window.addEventListener('load', function() {
    setTimeout(function() {
        restoreMusicProgress();
    }, 500);
});
    </script>
</body>
</html>